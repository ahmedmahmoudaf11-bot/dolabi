<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>دولابي</title>
<style>
body { font-family: Arial; background: #fff68f; margin:0; padding:0; text-align:center; }
h1 { color: red; margin: 20px 0; animation: slideIn 1s ease; }
@keyframes slideIn { from {transform: translateX(-100%);} to {transform: translateX(0);} }
#address { font-size: 14px; margin-bottom: 10px; }
#contact { font-size: 16px; margin-bottom: 20px; font-weight:bold; }
.product { display:inline-block; margin:10px; padding:10px; border:1px solid #ccc; border-radius:10px; width:150px; transition: transform 0.3s; }
.product:hover { transform: scale(1.1); }
.product img { width:100%; border-radius:10px; animation: zoomIn 0.5s ease; }
@keyframes zoomIn { from {transform: scale(0);} to {transform: scale(1);} }
#adminPanel { display:none; margin:20px; padding:20px; border:2px dashed #f00; }
input, button { padding:5px; margin:5px; }
#adminBtn { margin:20px; padding:10px 20px; background:red; color:white; border:none; cursor:pointer; border-radius:5px; }
</style>
</head>
<body>

<h1>دولابي</h1>
<div id="address">ديرب نجم بجوار كافيه المشربيه</div>
<div id="contact">للاستعلام: 01116535376</div>

<div id="products"></div>

<button id="adminBtn" onclick="toggleAdmin()">Admin</button>

<div id="adminPanel">
  <h2>لوحة الإدارة</h2>
  <input type="text" id="name" placeholder="اسم المنتج">
  <input type="file" id="imgFile" accept="image/*">
  <input type="text" id="price" placeholder="السعر">
  <button onclick="addProduct()">إضافة</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
// ====== Firebase config ======
const firebaseConfig = {
  apiKey: "AIzaSyChb7U4jURTdSv_Nb9D7jgwRzcRYhKb91w",
  authDomain: "ddoollaabbii.firebaseapp.com",
  projectId: "ddoollaabbii",
  storageBucket: "ddoollaabbii.firebasestorage.app",
  messagingSenderId: "635784319526",
  appId: "1:635784319526:web:e4eef00e3a718fc2be4ce7"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

// ====== Render products Realtime ======
db.collection('products').onSnapshot((snapshot) => {
  const container = document.getElementById('products');
  container.innerHTML = '';
  snapshot.forEach(doc => {
    const p = doc.data();
    const div = document.createElement('div');
    div.className = 'product';
    div.innerHTML = `
      <img src="${p.img}" alt="${p.name}">
      <p>${p.name}</p>
      <p>السعر: ${p.price}</p>
      <button onclick="deleteProduct('${doc.id}')">حذف</button>
    `;
    container.appendChild(div);
  });
});

// ====== Admin panel ======
function toggleAdmin() {
  const pass = prompt("ادخل كلمة السر للادمن:");
  if(pass === "dolabi123") {
    const panel = document.getElementById('adminPanel');
    panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
  } else {
    alert("كلمة السر غلط!");
  }
}

// ====== Add product مع رفع الصورة من الجهاز ======
function addProduct() {
  const name = document.getElementById('name').value;
  const file = document.getElementById('imgFile').files[0];
  const price = document.getElementById('price').value;

  if(!name || !file || !price) return alert("املأ كل الحقول واختر صورة");

  const storageRef = storage.ref('products/' + Date.now() + '_' + file.name);
  const uploadTask = storageRef.put(file);

  uploadTask.on('state_changed', 
    null,
    (error) => { alert("حدث خطأ أثناء رفع الصورة: " + error); },
    () => {
      uploadTask.snapshot.ref.getDownloadURL().then((url) => {
        db.collection('products').add({ name, img: url, price }).then(() => {
          confetti({ particleCount: 100, spread: 70 });
          document.getElementById('name').value='';
          document.getElementById('imgFile').value='';
          document.getElementById('price').value='';
        });
      });
    }
  );
}

// ====== Delete product ======
function deleteProduct(id) {
  db.collection('products').doc(id).delete();
}
</script>

</body>
</html>
